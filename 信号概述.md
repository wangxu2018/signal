# **信号概述**

## **信号共性**

- 简单、不能携带大量信息、满足某个特定条件才发送

## **信号的特质**

- 信号是软件层面上的中断。一旦信号产生，无论程序执行到什么位置，必须立即停止运行，处理信号，处理结束，再继续执行后续指令。因为信号是发生在软件层面的中断，因此之前经常被成为“软中断”
- 所有信号的产生、发送、处理全部都是由 **内核** 完成的，软件只是提醒内核产生中断

## **产生信号的几种方式**

- 按键产生，如：ctrl+c、ctrl+z、ctrl+\
- 系统调用产生，如：raise、kill、abort
- 软件条件产生，如：定时器alarm，我们用到的sleep就是借助定时器的机制来实现的
- 硬件异常产生，如：非法访问内存（段错误）、除0、内存对齐出错（总线错误）
- 命令产生，如：kill命令杀掉进程

## **信号相关的概念**

- **递达**

  - 信号产生并且送达到进程。将直接被内核处理掉

- **未决**
  - 产生与递达之间状态
  - 主要由于阻塞（屏蔽）导致该状态
  
- **几种信号处理方式**

  - 执行默认处理动作
  - 忽略
  - 捕捉（自定义的行为）

- **阻塞信号集（信号屏蔽字）**

  - 本质用位图实现，要么是0，要么是1
  - 用来记录信号的屏蔽状态

  - 被屏蔽的信号，在解除屏蔽前，一直处于未决态
  - 存在于PCB进程控制块中

- **未决信号集**
  - 本质用位图实现，要么是0，要么是1
  - 用来记录信号的处理状态
  
  - 该信号集中的信号表示已经产生，但尚未被处理 
  - 存在于PCB进程控制块中

## **信号4要素**

- 信号编号

- 信号名称

- 信号对应事件

- 信号默认处理动作

  注：信号使用之前，应先确定其4要素，而后再用
  
  不同操作系统的值可能不同，但是名称都是相同的



## **常规信号**

- **SIGHUP**: 当用户退出shell时，由该shell启动的所有进程将收到这个信号，默认动作为终止进程

- **SIGINT**：当用户按下了  ctrl+c  组合键时，用户终端向正在运行中的由该终端启动的程序发出此信号。默认动
  作为终止进程

- **SIGQUIT**：当用户按下 ctrl+\ 组合键时产生该信号，用户终端向正在运行中的由该终端启动的程序发出些信
  号。默认动作为终止进程

- SIGILL：CPU检测到某进程执行了非法指令。默认动作为终止进程并产生core文件

- SIGTRAP：该信号由断点指令或其他 trap指令产生。默认动作为终止里程 并产生core文件

- SIGABRT: 调用abort函数时产生该信号。默认动作为终止进程并产生core文件

- **SIGBUS**：非法访问内存地址，包括内存对齐出错，默认动作为终止进程并产生core文件

- **SIGFPE**：在发生致命的运算错误时发出。不仅包括浮点运算错误，还包括溢出及除数为0等所有的算法错误。默认动作为终止进程并产生core文件

- **SIGKILL**：无条件终止进程。本信号不能被忽略，处理和阻塞。默认动作为终止进程。它向系统管理员提供了可以杀死任何进程的方法

- **SIGUSE1**：用户定义 的信号。即程序员可以在程序中定义并使用该信号。默认动作为终止进程

- **SIGSEGV**：指示进程进行了无效内存访问。默认动作为终止进程并产生core文件

- SIGUSR2：另外一个用户自定义信号，程序员可以在程序中定义并使用该信号。默认动作为终止进程

- **SIGPIPE**：Broken pipe向一个没有读端的管道写数据。默认动作为终止进程

- **SIGALRM**: 定时器超时，超时的时间 由系统调用alarm设置。默认动作为终止进程

- **SIGTERM**：程序结束信号，与SIGKILL不同的是，该信号可以被阻塞和终止。通常用来要示程序正常退出。执行shell命令Kill时，缺省产生这个信号。默认动作为终止进程

- SIGSTKFLT：Linux早期版本出现的信号，现仍保留向后兼容。默认动作为终止进程

- **SIGCHLD**：子进程结束时，父进程会收到这个信号。默认动作为忽略这个信号

- SIGCONT：如果进程已停止，则使其继续运行。默认动作为继续/忽略

- SIGSTOP：停止进程的执行。信号不能被忽略，处理和阻塞。默认动作为暂停进程

- SIGTSTP：停止终端交互进程的运行。按下<ctrl+z>组合键时发出这个信号。默认动作为暂停进程

- SIGTTIN：后台进程读终端控制台。默认动作为暂停进程

- SIGTTOU: 该信号类似于SIGTTIN，在后台进程要向终端输出数据时发生。默认动作为暂停进程

- SIGURG：套接字上有紧急数据时，向当前正在运行的进程发出些信号，报告有紧急数据到达。如网络带外数据到达，默认动作为忽略该信号

- SIGXCPU：进程执行时间超过了分配给该进程的CPU时间 ，系统产生该信号并发送给该进程。默认动作为终止进程

- SIGXFSZ：超过文件的最大长度设置。默认动作为终止进程

- SIGVTALRM：虚拟时钟超时时产生该信号。类似于SIGALRM，但是该信号只计算该进程占用CPU的使用时间。默认动作为终止进程

- SGIPROF：类似于SIGVTALRM，它不公包括该进程占用CPU时间还包括执行系统调用时间。默认动作为终止进程。

- SIGWINCH：窗口变化大小时发出。默认动作为忽略该信号

- SIGIO：此信号向进程指示发出了一个异步IO事件。默认动作为忽略

- SIGPWR：关机。默认动作为终止进程

- SIGSYS：无效的系统调用。默认动作为终止进程并产生core文件

- SIGRTMIN ～ (64) SIGRTMAX：LINUX的实时信号，它们没有固定的含义（可以由用户自定义）。所有的实时信号的默认动作都为终止进程

